<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formazione Digitale 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
    <div class="container bg-white p-4 rounded shadow-sm" style="max-width: 500px;">
        <h2 id="titolo" class="text-center mb-4">Iscrizione Corso</h2>
        
        <div id="form-container">
            <div id="campi-registrazione">
                <input type="text" id="nome" class="form-control mb-2" placeholder="Nome">
                <input type="text" id="cognome" class="form-control mb-2" placeholder="Cognome">
                <input type="text" id="corso" class="form-control mb-2" placeholder="Nome Corso">
                <input type="text" id="cf" class="form-control mb-2" placeholder="Codice Fiscale">
                <input type="text" id="ente" class="form-control mb-2" placeholder="Ente/Associazione">
                <input type="text" id="telefono" class="form-control mb-2" placeholder="Telefono">
            </div>

            <input type="email" id="email" class="form-control mb-3" placeholder="Tua Email">
            
            <button onclick="invia()" id="btn-invia" class="btn btn-primary w-100">Invia</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx1STYL4ZGvfNA_n_LpQlwMh-trJtNqG-wc1iEbkXihX4RjuM_BS5pL1cKh2kRHilKm/exec";
        const urlParams = new URLSearchParams(window.location.search);
        const isCheckin = urlParams.has('checkin');

        // Se l'URL ha ?checkin, mostra solo l'email
        if(isCheckin) {
            document.getElementById('titolo').innerText = "Conferma Presenza in Aula";
            document.getElementById('campi-registrazione').style.display = 'none';
            document.getElementById('btn-invia').className = "btn btn-success w-100";
            document.getElementById('btn-invia').innerText = "Conferma Presenza";
        }

        async function invia() {
            const azione = isCheckin ? "checkin" : "registrazione";
            const payload = {
                action: azione,
                nome: document.getElementById('nome').value,
                cognome: document.getElementById('cognome').value,
                email: document.getElementById('email').value,
                cf: document.getElementById('cf').value,
                corso: document.getElementById('corso').value,
                ente: document.getElementById('ente').value,
                telefono: document.getElementById('telefono').value
            };

            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            const result = await response.text();
            alert(result);
            if(result.includes("Successo") || result.includes("Confermata")) window.location.reload();
        }
    </script>
</body>
</html>
